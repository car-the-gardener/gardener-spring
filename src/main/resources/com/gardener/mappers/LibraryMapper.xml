<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gardener.mappers.LibraryMapper">

    <resultMap id="postResultMap" type="Post">
        <id property="postnum" column="postnum"/>
        <result property="mainTitle" column="main_title"/>
        <result property="subTitle" column="sub_title"/>
        <result property="content" column="content"/>
        <result property="mainTitleImg" column="main_title_img"/>
        <result property="category" column="category"/>
        <association property="member" autoMapping="true" javaType="Member"
                     resultMap="memberResultMap"/>
    </resultMap>

    <resultMap id="memberResultMap" type="Member">
        <result property="nickname" column="nickname"/>
    </resultMap>


    <select id="getAllFavoritePost" resultMap="postResultMap">
        <![CDATA[
        select *
        from (select /*+ INDEX_DESC(p POST_INDEX)*/ rownum rn, postnum, main_title, sub_title, content, main_title_img, category, favorite, nickname
        from post p
        join member m on p.loginid = m.loginid
        where favorite > 0 and rownum <= 4) pm
        join favorite f on pm.postnum = f.postnum
        where loginid = #{loginid}
        AND rn >=0
        ]]>
    </select>

    <select id="getAllFavoritePostWithPaging" resultMap="postResultMap">
        <![CDATA[
        select *
        from (select /*+ INDEX_DESC(p POST_INDEX)*/ rownum rn, postnum, main_title, sub_title, content, main_title_img, category, favorite, nickname
        from post p
        join member m on p.loginid = m.loginid
        where favorite > 0 and rownum <= #{num} * 4) pm
        join favorite f on pm.postnum = f.postnum
        where loginid = #{loginid}
        AND rn > (#{num} - 1) * 4
        ]]>
    </select>
</mapper>
