<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gardener.mappers.LibraryMapper">


    <insert id="insertSubscribe">
        insert into subscribe (id, writer_id, loginid) values(seq_subscribe.nextval, #{writerId}, #{loginid})
    </insert>

    <select id="getSubscribe" resultType="Integer">
        select * from subscribe where loginid = #{loginid} and writer_id = #{writerId}
    </select>

    <resultMap id="postResultMap" type="Post">
        <id property="postnum" column="postnum"/>
        <result property="mainTitle" column="main_title"/>
        <result property="subTitle" column="sub_title"/>
        <result property="content" column="content"/>
        <result property="mainTitleImg" column="main_title_img"/>
        <result property="category" column="category"/>
        <association property="member" autoMapping="true" javaType="Member"
                     resultMap="memberResultMap"/>
    </resultMap>

    <resultMap id="memberResultMap" type="Member">
        <result property="nickname" column="nickname"/>
    </resultMap>

    <select id="getAllFavoritePostWithPaging" resultMap="postResultMap">
        <![CDATA[
        select  rn, id, postnum, main_title, sub_title, content, main_title_img, category, favorite, nickname
        from (select /*+ INDEX_DESC(f SYS_C007984)*/ rownum rn, f.id, f.postnum, main_title, sub_title, content, main_title_img, category, favorite, nickname
        from post p
               join member m on p.loginid = m.loginid
               join favorite f on f.postnum = p.postnum
        where favorite > 0 and f.loginid = #{loginid} and rownum <= #{num} * 4) where rn > (#{num} - 1) * 4
        ]]>
    </select>

    <delete id="deleteSubscibe">
        delete from subscribe where loginid = #{loginid} and writer_id = #{writerId}
    </delete>

</mapper>
